{"version":3,"file":"waifu-tips.js","sources":["../build/logger.js","../build/utils.js","../build/message.js","../build/model.js","../build/tools.js","../build/icons.js","../build/widget.js","../build/drag.js","../build/waifu-tips.js"],"sourcesContent":["class Logger {\n    constructor(level = 'info') {\n        this.level = level;\n    }\n    setLevel(level) {\n        if (!level)\n            return;\n        this.level = level;\n    }\n    shouldLog(level) {\n        return Logger.levelOrder[level] <= Logger.levelOrder[this.level];\n    }\n    error(message, ...args) {\n        if (this.shouldLog('error')) {\n            console.error('[Live2D Widget][ERROR]', message, ...args);\n        }\n    }\n    warn(message, ...args) {\n        if (this.shouldLog('warn')) {\n            console.warn('[Live2D Widget][WARN]', message, ...args);\n        }\n    }\n    info(message, ...args) {\n        if (this.shouldLog('info')) {\n            console.log('[Live2D Widget][INFO]', message, ...args);\n        }\n    }\n    trace(message, ...args) {\n        if (this.shouldLog('trace')) {\n            console.log('[Live2D Widget][TRACE]', message, ...args);\n        }\n    }\n}\nLogger.levelOrder = {\n    error: 0,\n    warn: 1,\n    info: 2,\n    trace: 3,\n};\nconst logger = new Logger();\nexport default logger;\n","function randomSelection(obj) {\n    return Array.isArray(obj) ? obj[Math.floor(Math.random() * obj.length)] : obj;\n}\nfunction randomOtherOption(total, excludeIndex) {\n    const idx = Math.floor(Math.random() * (total - 1));\n    return idx >= excludeIndex ? idx + 1 : idx;\n}\nfunction loadExternalResource(url, type) {\n    return new Promise((resolve, reject) => {\n        let tag;\n        if (type === 'css') {\n            tag = document.createElement('link');\n            tag.rel = 'stylesheet';\n            tag.href = url;\n        }\n        else if (type === 'js') {\n            tag = document.createElement('script');\n            tag.src = url;\n        }\n        if (tag) {\n            tag.onload = () => resolve(url);\n            tag.onerror = () => reject(url);\n            document.head.appendChild(tag);\n        }\n    });\n}\nexport { randomSelection, loadExternalResource, randomOtherOption };\n","import { randomSelection } from './utils.js';\nlet messageTimer = null;\nfunction showMessage(text, timeout, priority, override = true) {\n    let currentPriority = parseInt(sessionStorage.getItem('waifu-message-priority'), 10);\n    if (isNaN(currentPriority)) {\n        currentPriority = 0;\n    }\n    if (!text ||\n        (override && currentPriority > priority) ||\n        (!override && currentPriority >= priority))\n        return;\n    if (messageTimer) {\n        clearTimeout(messageTimer);\n        messageTimer = null;\n    }\n    text = randomSelection(text);\n    sessionStorage.setItem('waifu-message-priority', String(priority));\n    const tips = document.getElementById('waifu-tips');\n    tips.innerHTML = text;\n    tips.classList.add('waifu-tips-active');\n    messageTimer = setTimeout(() => {\n        sessionStorage.removeItem('waifu-message-priority');\n        tips.classList.remove('waifu-tips-active');\n    }, timeout);\n}\nfunction welcomeMessage(time, welcomeTemplate, referrerTemplate) {\n    if (location.pathname === '/') {\n        for (const { hour, text } of time) {\n            const now = new Date(), after = hour.split('-')[0], before = hour.split('-')[1] || after;\n            if (Number(after) <= now.getHours() &&\n                now.getHours() <= Number(before)) {\n                return text;\n            }\n        }\n    }\n    const text = i18n(welcomeTemplate, document.title);\n    if (document.referrer !== '') {\n        const referrer = new URL(document.referrer);\n        if (location.hostname === referrer.hostname)\n            return text;\n        return `${i18n(referrerTemplate, referrer.hostname)}<br>${text}`;\n    }\n    return text;\n}\nfunction i18n(template, ...args) {\n    return template.replace(/\\$(\\d+)/g, (_, idx) => {\n        var _b;\n        const i = parseInt(idx, 10) - 1;\n        return (_b = args[i]) !== null && _b !== void 0 ? _b : '';\n    });\n}\nexport { showMessage, welcomeMessage, i18n };\n","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nimport logger from './logger.js';\nimport { showMessage } from './message.js';\nimport { loadExternalResource, randomOtherOption } from './utils.js';\nclass ModelManager {\n    constructor(config, models = []) {\n        var _b;\n        this.modelList = null;\n        let { apiPath, cdnPath } = config;\n        const { cubism2Path, cubism5Path } = config;\n        let useCDN = false;\n        if (typeof cdnPath === 'string') {\n            if (!cdnPath.endsWith('/'))\n                cdnPath += '/';\n            useCDN = true;\n        }\n        else if (typeof apiPath === 'string') {\n            if (!apiPath.endsWith('/'))\n                apiPath += '/';\n            cdnPath = apiPath;\n            useCDN = true;\n            logger.warn('apiPath option is deprecated. Please use cdnPath instead.');\n        }\n        else if (!models.length) {\n            throw 'Invalid initWidget argument!';\n        }\n        let modelId = parseInt(localStorage.getItem('modelId'), 10);\n        let modelTexturesId = parseInt(localStorage.getItem('modelTexturesId'), 10);\n        if (isNaN(modelId) || isNaN(modelTexturesId)) {\n            modelTexturesId = 0;\n        }\n        if (isNaN(modelId)) {\n            modelId = (_b = config.modelId) !== null && _b !== void 0 ? _b : 0;\n        }\n        this.useCDN = useCDN;\n        this.cdnPath = cdnPath || '';\n        this.cubism2Path = cubism2Path || '';\n        this.cubism5Path = cubism5Path || '';\n        this._modelId = modelId;\n        this._modelTexturesId = modelTexturesId;\n        this.currentModelVersion = 0;\n        this.loading = false;\n        this.modelJSONCache = {};\n        this.models = models;\n    }\n    static initCheck(config_1) {\n        return __awaiter(this, arguments, void 0, function* (config, models = []) {\n            logger.info('üîß ModelManager.initCheck Ë¢´Ë∞ÉÁî®:');\n            logger.info(`  - config: ${JSON.stringify(config, null, 2)}`);\n            logger.info(`  - models Êï∞Èáè: ${models.length}`);\n            const model = new ModelManager(config, models);\n            logger.info(`  - useCDN: ${model.useCDN}`);\n            logger.info(`  - cdnPath: ${model.cdnPath}`);\n            if (model.useCDN) {\n                logger.info('üì° ‰ΩøÁî® CDN Ê®°ÂºèÔºåÂä†ËΩΩÊ®°ÂûãÂàóË°®');\n                const response = yield fetch(`${model.cdnPath}model_list.json`);\n                model.modelList = yield response.json();\n                if (model.modelId >= model.modelList.models.length) {\n                    model.modelId = 0;\n                }\n                const modelName = model.modelList.models[model.modelId];\n                if (Array.isArray(modelName)) {\n                    if (model.modelTexturesId >= modelName.length) {\n                        model.modelTexturesId = 0;\n                    }\n                }\n                else {\n                    const modelSettingPath = `${model.cdnPath}model/${modelName}/index.json`;\n                    const modelSetting = yield model.fetchWithCache(modelSettingPath);\n                    const version = model.checkModelVersion(modelSetting, modelSettingPath);\n                    if (version === 2) {\n                        const textureCache = yield model.loadTextureCache(modelName);\n                        if (model.modelTexturesId >= textureCache.length) {\n                            model.modelTexturesId = 0;\n                        }\n                    }\n                }\n            }\n            else {\n                if (model.modelId >= model.models.length) {\n                    model.modelId = 0;\n                }\n                if (model.modelTexturesId >= model.models[model.modelId].paths.length) {\n                    model.modelTexturesId = 0;\n                }\n            }\n            return model;\n        });\n    }\n    set modelId(modelId) {\n        this._modelId = modelId;\n        localStorage.setItem('modelId', modelId.toString());\n    }\n    get modelId() {\n        return this._modelId;\n    }\n    set modelTexturesId(modelTexturesId) {\n        this._modelTexturesId = modelTexturesId;\n        localStorage.setItem('modelTexturesId', modelTexturesId.toString());\n    }\n    get modelTexturesId() {\n        return this._modelTexturesId;\n    }\n    resetCanvas() {\n        document.getElementById('waifu-canvas').innerHTML =\n            '<canvas id=\"live2d\" width=\"800\" height=\"800\"></canvas>';\n    }\n    fetchWithCache(url) {\n        return __awaiter(this, void 0, void 0, function* () {\n            let result;\n            if (url in this.modelJSONCache) {\n                result = this.modelJSONCache[url];\n            }\n            else {\n                try {\n                    const response = yield fetch(url);\n                    result = yield response.json();\n                }\n                catch (_b) {\n                    result = null;\n                }\n                this.modelJSONCache[url] = result;\n            }\n            return result;\n        });\n    }\n    checkModelVersion(modelSetting, modelPath) {\n        logger.info('üîç Ê£ÄÊü•Ê®°ÂûãÁâàÊú¨:');\n        logger.info(`  - Ê®°ÂûãË∑ØÂæÑ: ${modelPath}`);\n        logger.info(`  - Ê®°ÂûãËÆæÁΩÆ: ${JSON.stringify(modelSetting, null, 2)}`);\n        if (modelPath) {\n            if (modelPath.includes('.model3.json')) {\n                logger.info('  ‚úÖ ÈÄöËøáÊñá‰ª∂Êâ©Â±ïÂêçÊ£ÄÊµãÂà∞ Cubism 3+ Ê®°Âûã (.model3.json)');\n                return 3;\n            }\n            if (modelPath.includes('.model.json')) {\n                logger.info('  ‚úÖ ÈÄöËøáÊñá‰ª∂Êâ©Â±ïÂêçÊ£ÄÊµãÂà∞ Cubism 2 Ê®°Âûã (.model.json)');\n                return 2;\n            }\n        }\n        if (modelSetting) {\n            if (modelSetting.Version === 3 || modelSetting.FileReferences) {\n                logger.info(`  ‚úÖ ÈÄöËøáËÆæÁΩÆÂÜÖÂÆπÊ£ÄÊµãÂà∞ Cubism 3+ Ê®°Âûã (Version=${modelSetting.Version}, FileReferences=${!!modelSetting.FileReferences})`);\n                return 3;\n            }\n            if (modelSetting.version || modelSetting.model) {\n                logger.info(`  ‚úÖ ÈÄöËøáËÆæÁΩÆÂÜÖÂÆπÊ£ÄÊµãÂà∞ Cubism 2 Ê®°Âûã (version=${modelSetting.version}, model=${!!modelSetting.model})`);\n                return 2;\n            }\n        }\n        logger.info('  ‚ö†Ô∏è Êó†Ê≥ïÁ°ÆÂÆöÊ®°ÂûãÁâàÊú¨ÔºåÈªòËÆ§‰ΩøÁî® Cubism 3+ (ÁâàÊú¨ 3)');\n        return 3;\n    }\n    loadLive2D(modelSettingPath, modelSetting) {\n        return __awaiter(this, void 0, void 0, function* () {\n            logger.info('üöÄ ÂºÄÂßãÂä†ËΩΩ Live2D Ê®°Âûã:');\n            logger.info(`  - Ê®°ÂûãËÆæÁΩÆË∑ØÂæÑ: ${modelSettingPath}`);\n            logger.info(`  - ÂΩìÂâçÂä†ËΩΩÁä∂ÊÄÅ: ${this.loading}`);\n            if (this.loading) {\n                logger.warn('Still loading. Abort.');\n                return;\n            }\n            this.loading = true;\n            try {\n                const version = this.checkModelVersion(modelSetting, modelSettingPath);\n                logger.info(`üìã Ê®°ÂûãÁâàÊú¨Ê£ÄÊµãÁªìÊûú: ${version}`);\n                if (version === 2) {\n                    logger.info('üé≠ ‰ΩøÁî® Cubism 2 ÂàÜÊîØÂä†ËΩΩÊ®°Âûã');\n                    logger.info(`  - cubism2Path: ${this.cubism2Path}`);\n                    logger.info(`  - cubism2model Â≠òÂú®: ${!!this.cubism2model}`);\n                    if (!this.cubism2model) {\n                        if (!this.cubism2Path) {\n                            logger.error('No cubism2Path set, cannot load Cubism 2 Core.');\n                            return;\n                        }\n                        yield loadExternalResource(this.cubism2Path, 'js');\n                        const { default: Cubism2Model } = yield import('./cubism2/index.js');\n                        this.cubism2model = new Cubism2Model();\n                    }\n                    if (this.currentModelVersion === 3) {\n                        this.cubism5model.release();\n                        this.resetCanvas();\n                    }\n                    if (this.currentModelVersion === 3 || !this.cubism2model.gl) {\n                        yield this.cubism2model.init('live2d', modelSettingPath, modelSetting);\n                    }\n                    else {\n                        yield this.cubism2model.changeModelWithJSON(modelSettingPath, modelSetting);\n                    }\n                }\n                else {\n                    logger.info('üé≠ ‰ΩøÁî® Cubism 5 ÂàÜÊîØÂä†ËΩΩÊ®°Âûã');\n                    logger.info(`  - cubism5Path: ${this.cubism5Path}`);\n                    logger.info(`  - cubism5model Â≠òÂú®: ${!!this.cubism5model}`);\n                    if (!this.cubism5Path) {\n                        logger.error('No cubism5Path set, cannot load Cubism 5 Core.');\n                        return;\n                    }\n                    logger.info(`üì¶ Âä†ËΩΩ Cubism 5 Core: ${this.cubism5Path}`);\n                    yield loadExternalResource(this.cubism5Path, 'js');\n                    logger.info('üì¶ ÂØºÂÖ• Cubism 5 Ê®°Âùó');\n                    const { AppDelegate: Cubism5Model } = yield import('./cubism5/index.js');\n                    logger.info('üèóÔ∏è ÂàõÂª∫ Cubism 5 Ê®°ÂûãÂÆû‰æã');\n                    this.cubism5model = new Cubism5Model();\n                    if (this.currentModelVersion === 2) {\n                        logger.info('üîÑ ‰ªé Cubism 2 ÂàáÊç¢Âà∞ Cubism 5ÔºåÈîÄÊØÅÊóßÊ®°Âûã');\n                        this.cubism2model.destroy();\n                        this.resetCanvas();\n                    }\n                    const needsInitialization = this.currentModelVersion === 2 ||\n                        !this.cubism5model.subdelegates.at(0);\n                    logger.info(`üîß ÊòØÂê¶ÈúÄË¶ÅÂàùÂßãÂåñ: ${needsInitialization}`);\n                    logger.info(`  - ÂΩìÂâçÊ®°ÂûãÁâàÊú¨: ${this.currentModelVersion}`);\n                    logger.info(`  - subdelegates Êï∞Èáè: ${this.cubism5model.subdelegates\n                        ? this.cubism5model.subdelegates.getSize()\n                        : 0}`);\n                    if (needsInitialization) {\n                        logger.info('üöÄ ÂàùÂßãÂåñ Cubism 5 Ê®°Âûã');\n                        this.cubism5model.initialize();\n                        logger.info(`üìÇ Êõ¥ÊîπÊ®°Âûã: ${modelSettingPath}`);\n                        this.cubism5model.changeModel(modelSettingPath);\n                        logger.info('‚ñ∂Ô∏è ÂêØÂä®Ê∏≤ÊüìÂæ™ÁéØ');\n                        this.cubism5model.run();\n                    }\n                    else {\n                        this.cubism5model.changeModel(modelSettingPath);\n                    }\n                }\n                logger.info(`Model ${modelSettingPath} (Cubism version ${version}) loaded`);\n                this.currentModelVersion = version;\n            }\n            catch (err) {\n                console.error('loadLive2D failed', err);\n            }\n            this.loading = false;\n        });\n    }\n    loadTextureCache(modelName) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const textureCache = yield this.fetchWithCache(`${this.cdnPath}model/${modelName}/textures.cache`);\n            return textureCache || [];\n        });\n    }\n    loadModel(message) {\n        return __awaiter(this, void 0, void 0, function* () {\n            logger.info('üéØ loadModel Ë¢´Ë∞ÉÁî®:');\n            logger.info(`  - message: ${JSON.stringify(message)}`);\n            logger.info(`  - useCDN: ${this.useCDN}`);\n            logger.info(`  - modelId: ${this.modelId}`);\n            let modelSettingPath, modelSetting;\n            if (this.useCDN) {\n                let modelName = this.modelList.models[this.modelId];\n                if (Array.isArray(modelName)) {\n                    modelName = modelName[this.modelTexturesId];\n                }\n                modelSettingPath = `${this.cdnPath}model/${modelName}/index.json`;\n                modelSetting = yield this.fetchWithCache(modelSettingPath);\n                const version = this.checkModelVersion(modelSetting, modelSettingPath);\n                if (version === 2) {\n                    const textureCache = yield this.loadTextureCache(modelName);\n                    let textures = textureCache[this.modelTexturesId];\n                    if (typeof textures === 'string')\n                        textures = [textures];\n                    modelSetting.textures = textures;\n                }\n            }\n            else {\n                logger.info('üì¶ ‰ΩøÁî®Ëá™ÂÆö‰πâÊ®°ÂûãÊ®°Âºè');\n                logger.info(`  - models Êï∞ÁªÑÈïøÂ∫¶: ${this.models.length}`);\n                logger.info(`  - ÂΩìÂâç modelId: ${this.modelId}`);\n                logger.info(`  - ÂΩìÂâç modelTexturesId: ${this.modelTexturesId}`);\n                if (this.models.length === 0) {\n                    logger.error('‚ùå Ëá™ÂÆö‰πâÊ®°ÂûãÊï∞ÁªÑ‰∏∫Á©∫ÔºÅ');\n                    return;\n                }\n                if (this.modelId >= this.models.length) {\n                    logger.warn(`‚ö†Ô∏è modelId (${this.modelId}) Ë∂ÖÂá∫ËåÉÂõ¥ÔºåÈáçÁΩÆ‰∏∫ 0`);\n                    this.modelId = 0;\n                }\n                const currentModel = this.models[this.modelId];\n                logger.info(`  - ÂΩìÂâçÊ®°Âûã: ${JSON.stringify(currentModel, null, 2)}`);\n                if (!currentModel.paths || currentModel.paths.length === 0) {\n                    logger.error('‚ùå ÂΩìÂâçÊ®°ÂûãÊ≤°Êúâ paths ÈÖçÁΩÆÔºÅ');\n                    return;\n                }\n                if (this.modelTexturesId >= currentModel.paths.length) {\n                    logger.warn(`‚ö†Ô∏è modelTexturesId (${this.modelTexturesId}) Ë∂ÖÂá∫ËåÉÂõ¥ÔºåÈáçÁΩÆ‰∏∫ 0`);\n                    this.modelTexturesId = 0;\n                }\n                modelSettingPath = currentModel.paths[this.modelTexturesId];\n                logger.info(`  - ÈÄâÊã©ÁöÑÊ®°ÂûãË∑ØÂæÑ: ${modelSettingPath}`);\n                modelSetting = yield this.fetchWithCache(modelSettingPath);\n            }\n            yield this.loadLive2D(modelSettingPath, modelSetting);\n            showMessage(message, 4000, 10);\n        });\n    }\n    loadRandTexture() {\n        return __awaiter(this, arguments, void 0, function* (successMessage = '', failMessage = '') {\n            const { modelId } = this;\n            let noTextureAvailable = false;\n            if (this.useCDN) {\n                const modelName = this.modelList.models[modelId];\n                if (Array.isArray(modelName)) {\n                    this.modelTexturesId = randomOtherOption(modelName.length, this.modelTexturesId);\n                }\n                else {\n                    const modelSettingPath = `${this.cdnPath}model/${modelName}/index.json`;\n                    const modelSetting = yield this.fetchWithCache(modelSettingPath);\n                    const version = this.checkModelVersion(modelSetting, modelSettingPath);\n                    if (version === 2) {\n                        const textureCache = yield this.loadTextureCache(modelName);\n                        if (textureCache.length <= 1) {\n                            noTextureAvailable = true;\n                        }\n                        else {\n                            this.modelTexturesId = randomOtherOption(textureCache.length, this.modelTexturesId);\n                        }\n                    }\n                    else {\n                        noTextureAvailable = true;\n                    }\n                }\n            }\n            else {\n                if (this.models[modelId].paths.length === 1) {\n                    noTextureAvailable = true;\n                }\n                else {\n                    this.modelTexturesId = randomOtherOption(this.models[modelId].paths.length, this.modelTexturesId);\n                }\n            }\n            if (noTextureAvailable) {\n                showMessage(failMessage, 4000, 10);\n            }\n            else {\n                yield this.loadModel(successMessage);\n            }\n        });\n    }\n    loadNextModel() {\n        return __awaiter(this, void 0, void 0, function* () {\n            this.modelTexturesId = 0;\n            if (this.useCDN) {\n                this.modelId = (this.modelId + 1) % this.modelList.models.length;\n                yield this.loadModel(this.modelList.messages[this.modelId]);\n            }\n            else {\n                this.modelId = (this.modelId + 1) % this.models.length;\n                yield this.loadModel(this.models[this.modelId].message);\n            }\n        });\n    }\n}\nexport { ModelManager };\n","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nimport { fa_comment, fa_paper_plane, fa_street_view, fa_shirt, fa_camera_retro, fa_info_circle, fa_xmark } from './icons.js';\nimport { showMessage, i18n } from './message.js';\nclass ToolsManager {\n    constructor(model, config, tips) {\n        this.config = config;\n        this.tools = {\n            hitokoto: {\n                icon: fa_comment,\n                callback: () => __awaiter(this, void 0, void 0, function* () {\n                    const response = yield fetch('https://v1.hitokoto.cn');\n                    const result = yield response.json();\n                    const template = tips.message.hitokoto;\n                    const text = i18n(template, result.from, result.creator);\n                    showMessage(result.hitokoto, 6000, 9);\n                    setTimeout(() => {\n                        showMessage(text, 4000, 9);\n                    }, 6000);\n                })\n            },\n            asteroids: {\n                icon: fa_paper_plane,\n                callback: () => {\n                    if (window.Asteroids) {\n                        if (!window.ASTEROIDSPLAYERS)\n                            window.ASTEROIDSPLAYERS = [];\n                        window.ASTEROIDSPLAYERS.push(new window.Asteroids());\n                    }\n                    else {\n                        const script = document.createElement('script');\n                        script.src =\n                            'https://fastly.jsdelivr.net/gh/stevenjoezhang/asteroids/asteroids.js';\n                        document.head.appendChild(script);\n                    }\n                }\n            },\n            'switch-model': {\n                icon: fa_street_view,\n                callback: () => model.loadNextModel()\n            },\n            'switch-texture': {\n                icon: fa_shirt,\n                callback: () => {\n                    let successMessage = '', failMessage = '';\n                    if (tips) {\n                        successMessage = tips.message.changeSuccess;\n                        failMessage = tips.message.changeFail;\n                    }\n                    model.loadRandTexture(successMessage, failMessage);\n                }\n            },\n            photo: {\n                icon: fa_camera_retro,\n                callback: () => {\n                    const message = tips.message.photo;\n                    showMessage(message, 6000, 9);\n                    const canvas = document.getElementById('live2d');\n                    if (!canvas)\n                        return;\n                    const imageUrl = canvas.toDataURL();\n                    const link = document.createElement('a');\n                    link.style.display = 'none';\n                    link.href = imageUrl;\n                    link.download = 'live2d-photo.png';\n                    document.body.appendChild(link);\n                    link.click();\n                    document.body.removeChild(link);\n                }\n            },\n            info: {\n                icon: fa_info_circle,\n                callback: () => {\n                    open('https://github.com/stevenjoezhang/live2d-widget');\n                }\n            },\n            quit: {\n                icon: fa_xmark,\n                callback: () => {\n                    localStorage.setItem('waifu-display', Date.now().toString());\n                    const message = tips.message.goodbye;\n                    showMessage(message, 2000, 11);\n                    const waifu = document.getElementById('waifu');\n                    if (!waifu)\n                        return;\n                    waifu.classList.remove('waifu-active');\n                    setTimeout(() => {\n                        waifu.classList.add('waifu-hidden');\n                        const waifuToggle = document.getElementById('waifu-toggle');\n                        waifuToggle === null || waifuToggle === void 0 ? void 0 : waifuToggle.classList.add('waifu-toggle-active');\n                    }, 3000);\n                }\n            }\n        };\n    }\n    registerTools() {\n        var _b;\n        if (!Array.isArray(this.config.tools)) {\n            this.config.tools = Object.keys(this.tools);\n        }\n        for (const toolName of this.config.tools) {\n            if (this.tools[toolName]) {\n                const { icon, callback } = this.tools[toolName];\n                const element = document.createElement('span');\n                element.id = `waifu-tool-${toolName}`;\n                element.innerHTML = icon;\n                (_b = document\n                    .getElementById('waifu-tool')) === null || _b === void 0 ? void 0 : _b.insertAdjacentElement('beforeend', element);\n                element.addEventListener('click', callback);\n            }\n        }\n    }\n}\nexport { ToolsManager };\n","const fa_comment = '<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 512 512\"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc. --><path d=\"M512 240c0 114.9-114.6 208-256 208c-37.1 0-72.3-6.4-104.1-17.9c-11.9 8.7-31.3 20.6-54.3 30.6C73.6 471.1 44.7 480 16 480c-6.5 0-12.3-3.9-14.8-9.9c-2.5-6-1.1-12.8 3.4-17.4c0 0 0 0 0 0s0 0 0 0s0 0 0 0c0 0 0 0 0 0l.3-.3c.3-.3 .7-.7 1.3-1.4c1.1-1.2 2.8-3.1 4.9-5.7c4.1-5 9.6-12.4 15.2-21.6c10-16.6 19.5-38.4 21.4-62.9C17.7 326.8 0 285.1 0 240C0 125.1 114.6 32 256 32s256 93.1 256 208z\"/></svg>';\nconst fa_paper_plane = '<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 512 512\"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc. --><path d=\"M498.1 5.6c10.1 7 15.4 19.1 13.5 31.2l-64 416c-1.5 9.7-7.4 18.2-16 23s-18.9 5.4-28 1.6L284 427.7l-68.5 74.1c-8.9 9.7-22.9 12.9-35.2 8.1S160 493.2 160 480l0-83.6c0-4 1.5-7.8 4.2-10.8L331.8 202.8c5.8-6.3 5.6-16-.4-22s-15.7-6.4-22-.7L106 360.8 17.7 316.6C7.1 311.3 .3 300.7 0 288.9s5.9-22.8 16.1-28.7l448-256c10.7-6.1 23.9-5.5 34 1.4z\"/></svg>';\nconst fa_street_view = '<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 512 512\"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc. --><path d=\"M320 64A64 64 0 1 0 192 64a64 64 0 1 0 128 0zm-96 96c-35.3 0-64 28.7-64 64l0 48c0 17.7 14.3 32 32 32l1.8 0 11.1 99.5c1.8 16.2 15.5 28.5 31.8 28.5l38.7 0c16.3 0 30-12.3 31.8-28.5L318.2 304l1.8 0c17.7 0 32-14.3 32-32l0-48c0-35.3-28.7-64-64-64l-64 0zM132.3 394.2c13-2.4 21.7-14.9 19.3-27.9s-14.9-21.7-27.9-19.3c-32.4 5.9-60.9 14.2-82 24.8c-10.5 5.3-20.3 11.7-27.8 19.6C6.4 399.5 0 410.5 0 424c0 21.4 15.5 36.1 29.1 45c14.7 9.6 34.3 17.3 56.4 23.4C130.2 504.7 190.4 512 256 512s125.8-7.3 170.4-19.6c22.1-6.1 41.8-13.8 56.4-23.4c13.7-8.9 29.1-23.6 29.1-45c0-13.5-6.4-24.5-14-32.6c-7.5-7.9-17.3-14.3-27.8-19.6c-21-10.6-49.5-18.9-82-24.8c-13-2.4-25.5 6.3-27.9 19.3s6.3 25.5 19.3 27.9c30.2 5.5 53.7 12.8 69 20.5c3.2 1.6 5.8 3.1 7.9 4.5c3.6 2.4 3.6 7.2 0 9.6c-8.8 5.7-23.1 11.8-43 17.3C374.3 457 318.5 464 256 464s-118.3-7-157.7-17.9c-19.9-5.5-34.2-11.6-43-17.3c-3.6-2.4-3.6-7.2 0-9.6c2.1-1.4 4.8-2.9 7.9-4.5c15.3-7.7 38.8-14.9 69-20.5z\"/></svg>';\nconst fa_shirt = '<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 640 512\"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc. --><path d=\"M211.8 0c7.8 0 14.3 5.7 16.7 13.2C240.8 51.9 277.1 80 320 80s79.2-28.1 91.5-66.8C413.9 5.7 420.4 0 428.2 0l12.6 0c22.5 0 44.2 7.9 61.5 22.3L628.5 127.4c6.6 5.5 10.7 13.5 11.4 22.1s-2.1 17.1-7.8 23.6l-56 64c-11.4 13.1-31.2 14.6-44.6 3.5L480 197.7 480 448c0 35.3-28.7 64-64 64l-192 0c-35.3 0-64-28.7-64-64l0-250.3-51.5 42.9c-13.3 11.1-33.1 9.6-44.6-3.5l-56-64c-5.7-6.5-8.5-15-7.8-23.6s4.8-16.6 11.4-22.1L137.7 22.3C155 7.9 176.7 0 199.2 0l12.6 0z\"/></svg>';\nconst fa_camera_retro = '<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 512 512\"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc. --><path d=\"M220.6 121.2L271.1 96 448 96l0 96-114.8 0c-21.9-15.1-48.5-24-77.2-24s-55.2 8.9-77.2 24L64 192l0-64 128 0c9.9 0 19.7-2.3 28.6-6.8zM0 128L0 416c0 35.3 28.7 64 64 64l384 0c35.3 0 64-28.7 64-64l0-320c0-35.3-28.7-64-64-64L271.1 32c-9.9 0-19.7 2.3-28.6 6.8L192 64l-32 0 0-16c0-8.8-7.2-16-16-16L80 32c-8.8 0-16 7.2-16 16l0 16C28.7 64 0 92.7 0 128zM168 304a88 88 0 1 1 176 0 88 88 0 1 1 -176 0z\"/></svg>';\nconst fa_info_circle = '<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 512 512\"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc. --><path d=\"M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512zM216 336l24 0 0-64-24 0c-13.3 0-24-10.7-24-24s10.7-24 24-24l48 0c13.3 0 24 10.7 24 24l0 88 8 0c13.3 0 24 10.7 24 24s-10.7 24-24 24l-80 0c-13.3 0-24-10.7-24-24s10.7-24 24-24zm40-208a32 32 0 1 1 0 64 32 32 0 1 1 0-64z\"/></svg>';\nconst fa_xmark = '<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 384 512\"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc. --><path d=\"M342.6 150.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L192 210.7 86.6 105.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L146.7 256 41.4 361.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L192 301.3 297.4 406.6c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L237.3 256 342.6 150.6z\"/></svg>';\nconst fa_child = '<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 320 512\"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc. --><path d=\"M96 64a64 64 0 1 1 128 0A64 64 0 1 1 96 64zm48 320l0 96c0 17.7-14.3 32-32 32s-32-14.3-32-32l0-192.2L59.1 321c-9.4 15-29.2 19.4-44.1 10S-4.5 301.9 4.9 287l39.9-63.3C69.7 184 113.2 160 160 160s90.3 24 115.2 63.6L315.1 287c9.4 15 4.9 34.7-10 44.1s-34.7 4.9-44.1-10L240 287.8 240 480c0 17.7-14.3 32-32 32s-32-14.3-32-32l0-96-32 0z\"/></svg>';\nexport { fa_comment, fa_paper_plane, fa_street_view, fa_shirt, fa_camera_retro, fa_info_circle, fa_xmark, fa_child };\n","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nimport registerDrag from './drag.js';\nimport { fa_child } from './icons.js';\nimport logger from './logger.js';\nimport { showMessage, welcomeMessage } from './message.js';\nimport { ModelManager } from './model.js';\nimport { ToolsManager } from './tools.js';\nimport { randomSelection } from './utils.js';\nfunction registerEventListener(tips) {\n    let userAction = false;\n    let userActionTimer;\n    const messageArray = tips.message.default;\n    tips.seasons.forEach(({ date, text }) => {\n        const now = new Date(), after = date.split('-')[0], before = date.split('-')[1] || after;\n        if (Number(after.split('/')[0]) <= now.getMonth() + 1 &&\n            now.getMonth() + 1 <= Number(before.split('/')[0]) &&\n            Number(after.split('/')[1]) <= now.getDate() &&\n            now.getDate() <= Number(before.split('/')[1])) {\n            text = randomSelection(text);\n            text = text.replace('{year}', String(now.getFullYear()));\n            messageArray.push(text);\n        }\n    });\n    let lastHoverElement;\n    window.addEventListener('mousemove', () => (userAction = true));\n    window.addEventListener('keydown', () => (userAction = true));\n    setInterval(() => {\n        if (userAction) {\n            userAction = false;\n            clearInterval(userActionTimer);\n            userActionTimer = null;\n        }\n        else if (!userActionTimer) {\n            userActionTimer = setInterval(() => {\n                showMessage(messageArray, 6000, 9);\n            }, 20000);\n        }\n    }, 1000);\n    window.addEventListener('mouseover', (event) => {\n        var _b;\n        for (let { selector, text } of tips.mouseover) {\n            if (!((_b = event.target) === null || _b === void 0 ? void 0 : _b.closest(selector)))\n                continue;\n            if (lastHoverElement === selector)\n                return;\n            lastHoverElement = selector;\n            text = randomSelection(text);\n            text = text.replace('{text}', event.target.innerText);\n            showMessage(text, 4000, 8);\n            return;\n        }\n    });\n    window.addEventListener('click', (event) => {\n        var _b;\n        for (let { selector, text } of tips.click) {\n            if (!((_b = event.target) === null || _b === void 0 ? void 0 : _b.closest(selector)))\n                continue;\n            text = randomSelection(text);\n            text = text.replace('{text}', event.target.innerText);\n            showMessage(text, 4000, 8);\n            return;\n        }\n    });\n    window.addEventListener('live2d:hoverbody', () => {\n        const text = randomSelection(tips.message.hoverBody);\n        showMessage(text, 4000, 8, false);\n    });\n    window.addEventListener('live2d:tapbody', () => {\n        const text = randomSelection(tips.message.tapBody);\n        showMessage(text, 4000, 9);\n    });\n    const devtools = () => { };\n    console.log('%c', devtools);\n    devtools.toString = () => {\n        showMessage(tips.message.console, 6000, 9);\n    };\n    window.addEventListener('copy', () => {\n        showMessage(tips.message.copy, 6000, 9);\n    });\n    window.addEventListener('visibilitychange', () => {\n        if (!document.hidden)\n            showMessage(tips.message.visibilitychange, 6000, 9);\n    });\n}\nfunction loadWidget(config) {\n    return __awaiter(this, void 0, void 0, function* () {\n        var _b;\n        localStorage.removeItem('waifu-display');\n        sessionStorage.removeItem('waifu-message-priority');\n        document.body.insertAdjacentHTML('beforeend', `<div id=\"waifu\">\r\n       <div id=\"waifu-tips\"></div>\r\n       <div id=\"waifu-canvas\">\r\n         <canvas id=\"live2d\" width=\"800\" height=\"800\"></canvas>\r\n       </div>\r\n       <div id=\"waifu-tool\"></div>\r\n     </div>`);\n        let models = [];\n        let tips;\n        if (config.models && Array.isArray(config.models)) {\n            logger.info(`‰ΩøÁî®ÈÖçÁΩÆ‰∏≠ÁöÑËá™ÂÆö‰πâÊ®°ÂûãÂàóË°®ÔºåÂÖ± ${config.models.length} ‰∏™Ê®°Âûã`);\n            models = config.models;\n        }\n        else if (config.waifuPath) {\n            const response = yield fetch(config.waifuPath);\n            tips = yield response.json();\n            models = tips.models;\n            registerEventListener(tips);\n            showMessage(welcomeMessage(tips.time, tips.message.welcome, tips.message.referrer), 7000, 11);\n        }\n        const model = yield ModelManager.initCheck(config, models);\n        yield model.loadModel('');\n        new ToolsManager(model, config, tips).registerTools();\n        if (config.drag)\n            registerDrag();\n        (_b = document.getElementById('waifu')) === null || _b === void 0 ? void 0 : _b.classList.add('waifu-active');\n        window.modelManager = model;\n    });\n}\nfunction initWidget(config) {\n    if (typeof config === 'string') {\n        logger.error('Your config for Live2D initWidget is outdated. Please refer to https://github.com/stevenjoezhang/live2d-widget/blob/master/dist/autoload.js');\n        return;\n    }\n    logger.setLevel(config.logLevel);\n    document.body.insertAdjacentHTML('beforeend', `<div id=\"waifu-toggle\">\r\n       ${fa_child}\r\n     </div>`);\n    const toggle = document.getElementById('waifu-toggle');\n    toggle === null || toggle === void 0 ? void 0 : toggle.addEventListener('click', () => {\n        var _b;\n        toggle === null || toggle === void 0 ? void 0 : toggle.classList.remove('waifu-toggle-active');\n        if (toggle === null || toggle === void 0 ? void 0 : toggle.getAttribute('first-time')) {\n            loadWidget(config);\n            toggle === null || toggle === void 0 ? void 0 : toggle.removeAttribute('first-time');\n        }\n        else {\n            localStorage.removeItem('waifu-display');\n            (_b = document.getElementById('waifu')) === null || _b === void 0 ? void 0 : _b.classList.remove('waifu-hidden');\n            setTimeout(() => {\n                var _b;\n                (_b = document.getElementById('waifu')) === null || _b === void 0 ? void 0 : _b.classList.add('waifu-active');\n            }, 0);\n        }\n    });\n    if (localStorage.getItem('waifu-display') &&\n        Date.now() - Number(localStorage.getItem('waifu-display')) <= 86400000) {\n        toggle === null || toggle === void 0 ? void 0 : toggle.setAttribute('first-time', 'true');\n        setTimeout(() => {\n            toggle === null || toggle === void 0 ? void 0 : toggle.classList.add('waifu-toggle-active');\n        }, 0);\n    }\n    else {\n        loadWidget(config);\n    }\n}\nexport { initWidget };\n","function registerDrag() {\n    const element = document.getElementById('waifu');\n    if (!element)\n        return;\n    let winWidth = window.innerWidth, winHeight = window.innerHeight;\n    const imgWidth = element.offsetWidth, imgHeight = element.offsetHeight;\n    element.addEventListener('mousedown', event => {\n        if (event.button === 2) {\n            return;\n        }\n        const canvas = document.getElementById('live2d');\n        if (event.target !== canvas)\n            return;\n        event.preventDefault();\n        const _offsetX = event.offsetX, _offsetY = event.offsetY;\n        document.onmousemove = event => {\n            const _x = event.clientX, _y = event.clientY;\n            let _left = _x - _offsetX, _top = _y - _offsetY;\n            if (_top < 0) {\n                _top = 0;\n            }\n            else if (_top >= winHeight - imgHeight) {\n                _top = winHeight - imgHeight;\n            }\n            if (_left < 0) {\n                _left = 0;\n            }\n            else if (_left >= winWidth - imgWidth) {\n                _left = winWidth - imgWidth;\n            }\n            element.style.top = _top + 'px';\n            element.style.left = _left + 'px';\n        };\n        document.onmouseup = () => {\n            document.onmousemove = null;\n        };\n    });\n    window.onresize = () => {\n        winWidth = window.innerWidth;\n        winHeight = window.innerHeight;\n    };\n}\nexport default registerDrag;\n","import { initWidget } from './widget.js';\nwindow.initWidget = initWidget;\n"],"names":["Logger","constructor","level","this","setLevel","shouldLog","levelOrder","error","message","args","console","warn","info","log","trace","logger","randomSelection","obj","Array","isArray","Math","floor","random","length","randomOtherOption","total","excludeIndex","idx","loadExternalResource","url","type","Promise","resolve","reject","tag","document","createElement","src","onload","onerror","head","appendChild","messageTimer","showMessage","text","timeout","priority","override","currentPriority","parseInt","sessionStorage","getItem","isNaN","clearTimeout","setItem","String","tips","getElementById","innerHTML","classList","add","setTimeout","removeItem","remove","i18n","template","replace","_","_b","i","__awaiter","thisArg","_arguments","P","generator","fulfilled","value","step","next","e","rejected","result","done","then","apply","ModelManager","config","models","modelList","apiPath","cdnPath","cubism2Path","cubism5Path","useCDN","endsWith","modelId","localStorage","modelTexturesId","_modelId","_modelTexturesId","currentModelVersion","loading","modelJSONCache","initCheck","config_1","arguments","JSON","stringify","model","response","fetch","json","modelName","modelSettingPath","modelSetting","fetchWithCache","checkModelVersion","textureCache","loadTextureCache","paths","toString","resetCanvas","modelPath","includes","Version","FileReferences","version","loadLive2D","cubism2model","default","Cubism2Model","import","cubism5model","release","gl","changeModelWithJSON","init","AppDelegate","Cubism5Model","destroy","needsInitialization","subdelegates","at","getSize","initialize","changeModel","run","err","loadModel","textures","currentModel","loadRandTexture","successMessage","failMessage","noTextureAvailable","loadNextModel","messages","ToolsManager","tools","hitokoto","icon","callback","from","creator","asteroids","window","Asteroids","ASTEROIDSPLAYERS","push","script","changeSuccess","changeFail","photo","canvas","imageUrl","toDataURL","link","style","display","href","download","body","click","removeChild","open","quit","Date","now","goodbye","waifu","waifuToggle","registerTools","Object","keys","toolName","element","id","insertAdjacentElement","addEventListener","loadWidget","insertAdjacentHTML","waifuPath","userActionTimer","userAction","messageArray","lastHoverElement","seasons","forEach","date","after","split","before","Number","getMonth","getDate","getFullYear","setInterval","clearInterval","event","selector","mouseover","target","closest","innerText","hoverBody","tapBody","devtools","copy","hidden","visibilitychange","registerEventListener","time","welcomeTemplate","referrerTemplate","location","pathname","hour","getHours","title","referrer","URL","hostname","welcomeMessage","welcome","drag","winWidth","innerWidth","winHeight","innerHeight","imgWidth","offsetWidth","imgHeight","offsetHeight","button","preventDefault","_offsetX","offsetX","_offsetY","offsetY","onmousemove","_x","clientX","_y","clientY","_left","_top","top","left","onmouseup","onresize","registerDrag","modelManager","initWidget","logLevel","toggle","getAttribute","removeAttribute","setAttribute"],"mappings":"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"}